<!-- cart.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cart</title>
  <style>
    a {
      text-decoration: none;
      color: black;
      padding: 6px 12px;
    }
    a:hover {
      text-decoration: underline;
    }
    .active {
      color: #3d8361;
      font-weight: bold;
      pointer-events: none;
    }
    .cart-container {
      display: flex;
      padding: 40px 60px;
      gap: 40px;
    }
    .cart-items, .order-summary {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .cart-items {
      flex: 2;
    }
    .order-summary {
      flex: 1;
    }
    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #ddd;
      padding: 15px 0;
    }
    .cart-item img {
      width: 60px;
      height: 90px;
      object-fit: cover;
      
      margin-right: 20px;
    }
    .item-details {
      flex: 1;
    }
    .item-title {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .item-author {
      color: gray;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .item-price {
      font-weight: bold;
      color: #3d8361;
      font-size: 16px;
    }
    .item-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .item-actions .quantity-controls {
      display: flex;
      align-items: center;
    }
    .item-actions .quantity-controls button {
        width: 30px;
        height: 30px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        cursor: pointer;
    }
    .item-actions .quantity-controls button:disabled {
        cursor: not-allowed;
        opacity: 0.5;
    }
    .item-actions input {
      width: 50px;
      padding: 5px;
      text-align: center;
      border: 1px solid #ccc;
      border-left: none;
      border-right: none;
      border-radius: 0;
    }
    .remove-btn, .details-btn {
      background: none;
      border: none;
      color: #3d8361;
      cursor: pointer;
      font-size: 14px;
      text-decoration: underline;
    }
    .order-summary h3 {
      margin-top: 0;
      margin-bottom: 20px;
    }
    .order-summary-items p {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }
    .promo-code {
      display: flex;
      margin: 20px 0;
    }
    .promo-code input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px 0 0 4px;
    }
    .promo-code button {
      padding: 8px 16px;
      background-color: black;
      color: white;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
    .checkout-btn {
      display: block;
      width: 100%;
      padding: 12px;
      background-color: #3d8361;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }
    .nav {
    background-color: #f2f2f2;
  display: flex;
  justify-content: space-evenly;
  padding: 15px 0;
  font-size: 18px;
}

.nav a {
  background-color: #f2f2f2;
  color: black;
  text-decoration: none;
  padding: 10px 16px;
  border-radius: 4px;
  margin: 0 5px;
  transition: background-color 0.3s ease;
}

.nav a:hover {
  background-color: #ddd;
  color: black;
}

.nav a.active {
    background-color: #f2f2f2;
  color: #3d8361;
  font-weight: bold;
  pointer-events: none;
}
  </style>
</head>
<body style="font-family: Times New Roman; background-color: #f9f9f9; margin: 0;">
<!-- Common Header -->
<div style="background-color:#f2f2f2; padding: 20px 0;margin:0">
  <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 60px; gap: 20px;">
    <div>
      <img src="logo_img.png" alt="Logo" style="height:50px;">
    </div>
    <div style="flex-grow: 1; display: flex; justify-content: center;">
      <input type="text" placeholder="Search books..."
            style="width: 300px; padding: 8px; font-size: 16px; border:none; border-radius: 4px 0 0 4px;margin-right: 10px;">
      <button type="button"
              style="padding: 8px 16px; background-color: #3d8361; color: white; border: none; border-radius: 0 4px 4px 0; cursor: pointer;">
        Search
      </button>
    </div>
    <div style="text-align: right;">
      <h2 style="margin: 0;">Astra</h2>
      <p style="margin: 0;">Online Bookstore Portal</p>
    </div>
  </div>
  <hr style="margin: 10px 10px;">
  <div class="nav"style="display: flex; justify-content: space-evenly; padding: 0 80px; font-size: 18px;">
    <a href="index.html" class="nav-link">Home</a>
    <a href="login.html" class="nav-link">Login</a>
    <a href="categories.html" class="nav-link">Categories</a>
    <a href="cart.html" class="nav-link active">Cart (<span id="cart-count">0</span>)</a>
    <a href="catalogue.html" class="nav-link">Catalogue</a>
    <a href="offers.html">Offers</a>
  </div>
</div>

<!-- Cart Section -->
<div class="cart-container">
  <div class="cart-items" id="cart-items-container">
    <h2>üõí My Shopping Cart</h2>
    <!-- Cart items will be dynamically inserted here -->
  </div>

  <div class="order-summary">
    <h3>My Order</h3>
    <div id="order-summary-items">
      <!-- Order summary items will be dynamically inserted here -->
    </div>
    <div class="promo-code">
      <input type="text" placeholder="Enter promo code">
      <button>Redeem</button>
    </div>
    <div id="discount-summary">
        <!-- Discount details will be shown here -->
    </div>
    <h3 id="order-total">Total: $0</h3>
    <a href="checkout.html">
        <button class="checkout-btn">Checkout</button>
    </a>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const cartItemsContainer = document.getElementById('cart-items-container');
        const orderSummaryItemsContainer = document.getElementById('order-summary-items');
        const orderTotalElement = document.getElementById('order-total');
        const cartCountElement = document.getElementById('cart-count');
        const discountSummaryContainer = document.getElementById('discount-summary');

        // --- Core Functions ---
        function getCart() {
            return JSON.parse(localStorage.getItem('bookCart')) || [];
        }

        function saveCart(cart) {
            localStorage.setItem('bookCart', JSON.stringify(cart));
            renderCart();
        }

        function renderCart() {
            const cart = getCart();
            cartItemsContainer.innerHTML = '<h2>üõí My Shopping Cart</h2>'; // Reset container
            orderSummaryItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML += '<p>Your cart is empty.</p><a href="index.html" style="font-size: 16px; display: block; margin-top: 20px;">‚Üê Back to Store</a>';
            } else {
                 cart.forEach(item => {
                    cartItemsContainer.innerHTML += createCartItemHtml(item);
                    orderSummaryItemsContainer.innerHTML += createSummaryItemHtml(item);
                });
                cartItemsContainer.innerHTML += '<a href="index.html" style="font-size: 16px; display: block; margin-top: 20px;">‚Üê Back to Store</a>';
            }
            updateTotal(); // Call with default 0 discount
            addEventListeners();
            updateCartCount();
        }
        
        // Task 9: Calculate total with discount
        function updateTotal(discount = 0) {
            const cart = getCart();
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantityInCart), 0);
            const discountAmount = subtotal * (discount / 100);
            const finalTotal = subtotal - discountAmount;

            orderTotalElement.textContent = `Total: $${finalTotal.toFixed(2)}`;

            if (discount > 0) {
                discountSummaryContainer.innerHTML = `
                    <p style="display: flex; justify-content: space-between;"><span>Subtotal:</span> <span>$${subtotal.toFixed(2)}</span></p>
                    <p style="display: flex; justify-content: space-between; color: crimson;"><span>Discount (${discount}%):</span> <span>-$${discountAmount.toFixed(2)}</span></p>
                `;
            } else {
                discountSummaryContainer.innerHTML = ''; // Clear if no discount
            }
        }


        function updateCartCount() {
            cartCountElement.textContent = getCart().length;
        }

        // --- HTML Generation ---
        function createCartItemHtml(item) {
            const MAX_QTY = 10;
            return `
                <div class="cart-item" id="item-${item.id}">
                    <img src="${item.img}" alt="${item.title}">
                    <div class="item-details">
                        <div class="item-title">${item.title}</div>
                        <div class="item-author" style="display: block;">${item.author}</div>
                        <div class="item-price">$${item.price}</div>
                        <button class="details-btn" data-id="${item.id}">Hide Details</button>
                    </div>
                    <div class="item-actions">
                        <div class="quantity-controls">
                            <button class="quantity-minus" data-id="${item.id}" ${item.quantityInCart <= 1 ? 'disabled' : ''}>-</button>
                            <input type="number" value="${item.quantityInCart}" min="1" max="${MAX_QTY}" data-id="${item.id}" readonly>
                            <button class="quantity-plus" data-id="${item.id}" ${item.quantityInCart >= MAX_QTY ? 'disabled' : ''}>+</button>
                        </div>
                        <button class="remove-btn" data-id="${item.id}">Remove</button>
                    </div>
                </div>
            `;
        }
        
        function createSummaryItemHtml(item) {
            return `<p><span>${item.quantityInCart}x ${item.title}</span><span>$${(item.price * item.quantityInCart).toFixed(2)}</span></p>`;
        }
        
        // --- Event Handling ---
        function addEventListeners() {
            document.querySelectorAll('.quantity-plus').forEach(button => {
                button.onclick = (e) => updateQuantity(e.target.dataset.id, 1);
            });
            document.querySelectorAll('.quantity-minus').forEach(button => {
                button.onclick = (e) => updateQuantity(e.target.dataset.id, -1);
            });
            document.querySelectorAll('.remove-btn').forEach(button => {
                button.onclick = (e) => removeItem(e.target.dataset.id);
            });
            document.querySelectorAll('.details-btn').forEach(button => {
                button.onclick = (e) => toggleDetails(e.target.dataset.id, e.target);
            });
            document.querySelector('.promo-code button').addEventListener('click', applyPromoCode);
        }

        function updateQuantity(bookId, change) {
            let cart = getCart();
            const item = cart.find(i => i.id == bookId);
            if (!item) return;

            const newQuantity = item.quantityInCart + change;
            const MAX_QTY = 10;

            if (newQuantity > 0 && newQuantity <= MAX_QTY) {
                item.quantityInCart = newQuantity;
            }
            
            if (newQuantity >= MAX_QTY) {
                alert("Maximum quantity reached!");
            }

            saveCart(cart);
        }

        function removeItem(bookId) {
            let cart = getCart().filter(i => i.id != bookId);
            saveCart(cart);
        }
        
        function applyPromoCode() {
            const promoInput = document.querySelector('.promo-code input');
            const promoCode = promoInput.value.trim().toUpperCase();
            let discount = 0;

            if (promoCode === 'SUMMER25') {
                discount = 25; // 25% discount
                alert('25% discount applied!');
            } else if (promoCode !== '') {
                alert('Invalid promo code.');
            }
            updateTotal(discount);
        }

        function toggleDetails(bookId, button) {
            const itemElement = document.getElementById(`item-${bookId}`);
            const authorElement = itemElement.querySelector('.item-author');
            
            if (authorElement.style.display === 'none') {
                authorElement.style.display = 'block';
                button.textContent = 'Hide Details';
            } else {
                authorElement.style.display = 'none';
                button.textContent = 'Show Details';
            }
        }
        
        // --- Initial Load ---
        renderCart();
    });
</script>

</body>
</html>
