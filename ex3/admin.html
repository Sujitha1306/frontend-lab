<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Bookstore</title>
  <style>
    body { margin: 0; background-color: #f5f5f5; font-family: 'Times New Roman', Times, serif; }
    a { text-decoration: none; color: black; padding: 6px 12px; }
    a:hover { text-decoration: underline; }
    .active { color: #3d8361; font-weight: bold; pointer-events: none; }
    .header { background-color: #f2f2f2; padding: 20px 0; }
    .header-inner { display: flex; justify-content: space-between; align-items: center; padding: 0 60px; gap: 20px; }
    .nav { background-color: #f2f2f2; display: flex; justify-content: space-evenly; padding: 15px 0; font-size: 18px; }
    .content { padding: 30px 60px; max-width: 1200px; margin: auto; }
    button {
      background-color: #3d8361;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 0;
      transition: background-color 0.3s;
      width: 100%;
    }
    button:hover { background-color: #55b888; }
    .btn-delete { background-color: #c0392b; }
    .btn-delete:hover { background-color: #e74c3c; }
    .btn-update { background-color: #2980b9; }
    .btn-update:hover { background-color: #3498db; }

    .login-container {
        background-color: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-top: 30px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }
    .login-container input {
        width: 100%;
        padding: 12px;
        margin: 10px 0 20px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .error-message { color: crimson; margin-bottom: 15px; }

    /* New Admin Panel Layout */
    .admin-panel-layout {
        display: flex;
        gap: 30px;
        margin-top: 30px;
    }
    #sidebar {
        width: 300px;
        flex-shrink: 0;
    }
    #book-display-area {
        flex-grow: 1;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
    }
    .form-container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .form-container h3 {
        margin-top: 0;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }
    .form-container label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-container input {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    /* Book Card Styles */
    .book-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        padding: 16px;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .book-card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 6px;
        margin-bottom: 12px;
        background-color: #eee;
    }
    .book-card h4 { margin: 8px 0 4px; font-size: 16px; }
    .book-card p { margin: 2px 0; color: #555; font-size: 14px; }
    .book-card .price { font-weight: bold; color: #3d8361; }
    .book-card .actions button {
        width: calc(50% - 5px);
        font-size: 14px;
        padding: 8px;
        display: inline-block;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <div class="header-inner">
      <div><img src="logo_img.png" alt="Logo" style="height:50px;"></div>
      <div style="text-align: right;">
        <h2 style="margin: 0;">Astra</h2>
        <p style="margin: 0;">Online Bookstore Portal</p>
      </div>
    </div>
    <hr style="margin: 10px;">
    <div class="nav">
      <a href="index.html">Home</a>
      <a href="login.html">Login</a>
      <a href="catalogue.html">Catalogue</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content">
    
    <!-- Login Form -->
    <div id="login-container" class="login-container">
        <h1>Admin Login</h1>
        <form id="login-form">
            <div id="error-message" class="error-message" style="display: none;"></div>
            <label for="email">Email:</label>
            <input type="email" id="email" required>
            <label for="password">Password:</label>
            <input type="password" id="password" required>
            <button type="submit">Login</button>
        </form>
    </div>

    <!-- Admin Panel (hidden by default) -->
    <div id="admin-panel" class="admin-panel-layout" style="display: none;">
        <div id="sidebar">
            <div id="form-container" class="form-container">
                <!-- Form will be injected here by JS -->
            </div>
        </div>
        <div id="book-display-area">
            <!-- Book cards will be injected here -->
        </div>
    </div>
  </div>

<script>
    let allBooks = [];
    
    const loginContainer = document.getElementById('login-container');
    const adminPanel = document.getElementById('admin-panel');
    const loginForm = document.getElementById('login-form');
    const errorMessage = document.getElementById('error-message');
    const formContainer = document.getElementById('form-container');
    const bookDisplayArea = document.getElementById('book-display-area');

    // --- Login Logic ---
    loginForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (email === 'admin@gmail.com' && password === 'Admin1234') {
            loginContainer.style.display = 'none';
            adminPanel.style.display = 'flex';
            loadInitialData();
        } else {
            errorMessage.textContent = 'Invalid email or password.';
            errorMessage.style.display = 'block';
        }
    });

    // --- Core Functions ---
    async function loadInitialData() {
        try {
            const response = await fetch('books.json');
            if (!response.ok) throw new Error('Failed to fetch books.json');
            const data = await response.json();
            allBooks = [
                ...data.recommendedBooks, ...data.littleReaderBooks,
                ...data.bestsellers, ...data.selfDevelopmentBooks
            ];
            renderAllBooks();
            showCreateForm();
        } catch (error) {
            bookDisplayArea.innerHTML = `<p style="color: red;">Error: Could not load book data.</p>`;
        }
    }

    function renderAllBooks() {
        bookDisplayArea.innerHTML = '';
        allBooks.forEach(book => {
            const card = document.createElement('div');
            card.className = 'book-card';
            card.innerHTML = `
                <img src="${book.img || 'https://placehold.co/200x230/eef2e6/777?text=No+Image'}" alt="${book.title}">
                <div>
                    <h4>${book.title}</h4>
                    <p>${book.author}</p>
                    <p class="price">$${book.price.toFixed(2)}</p>
                    <p>Stock: ${book.quantity}</p>
                </div>
                <div class="actions">
                    <button class="btn-update" onclick="showUpdateForm(${book.id})">Update</button>
                    <button class="btn-delete" onclick="deleteBook(${book.id})">Delete</button>
                </div>
            `;
            bookDisplayArea.appendChild(card);
        });
    }

    // --- Form Display Functions ---
    function showCreateForm() {
        formContainer.innerHTML = `
            <h3>Create New Book</h3>
            <form id="create-form">
                <label for="title">Title:</label><input type="text" id="title" required>
                <label for="author">Author:</label><input type="text" id="author" required>
                <label for="price">Price:</label><input type="number" id="price" step="0.01" required>
                <label for="quantity">Quantity:</label><input type="number" id="quantity" required>
                <label for="img">Image URL:</label><input type="text" id="img">
                <button type="submit">Create Book</button>
            </form>
        `;
        document.getElementById('create-form').addEventListener('submit', createBook);
    }

    window.showUpdateForm = function(bookId) {
        const book = allBooks.find(b => b.id === bookId);
        if (!book) return;
        formContainer.innerHTML = `
            <h3>Update Book</h3>
            <form id="update-form">
                <input type="hidden" id="update-id" value="${book.id}">
                <label for="update-title">Title:</label><input type="text" id="update-title" value="${book.title}" required>
                <label for="update-author">Author:</label><input type="text" id="update-author" value="${book.author}" required>
                <label for="update-price">Price:</label><input type="number" id="update-price" step="0.01" value="${book.price}" required>
                <label for="update-quantity">Quantity:</label><input type="number" id="update-quantity" value="${book.quantity}" required>
                <label for="update-img">Image URL:</label><input type="text" id="update-img" value="${book.img}">
                <button type="submit">Save Changes</button>
                <button type="button" onclick="showCreateForm()">Cancel</button>
            </form>
        `;
        document.getElementById('update-form').addEventListener('submit', updateBook);
    }
    
    // --- CRUD Logic ---
    function createBook(event) {
        event.preventDefault();
        const newBook = {
            id: Date.now(),
            title: document.getElementById('title').value,
            author: document.getElementById('author').value,
            price: parseFloat(document.getElementById('price').value),
            quantity: parseInt(document.getElementById('quantity').value),
            img: document.getElementById('img').value,
            rating: 0 // Default rating
        };
        allBooks.push(newBook);
        renderAllBooks();
        event.target.reset(); // Clear the form
    }

    function updateBook(event) {
        event.preventDefault();
        const bookId = parseInt(document.getElementById('update-id').value);
        const bookIndex = allBooks.findIndex(b => b.id === bookId);
        if (bookIndex === -1) return;

        allBooks[bookIndex] = {
            ...allBooks[bookIndex],
            title: document.getElementById('update-title').value,
            author: document.getElementById('update-author').value,
            price: parseFloat(document.getElementById('update-price').value),
            quantity: parseInt(document.getElementById('update-quantity').value),
            img: document.getElementById('update-img').value
        };
        renderAllBooks();
        showCreateForm(); // Switch back to create form after update
    }

    window.deleteBook = function(bookId) {
        if (confirm('Are you sure you want to delete this book?')) {
            allBooks = allBooks.filter(b => b.id !== bookId);
            renderAllBooks();
            showCreateForm(); // Ensure create form is showing if an update was cancelled
        }
    }
</script>
</body>
</html>
