<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online Bookstore</title>
  <style>
    a {
  text-decoration: none;
  color: black;
  padding: 6px 12px;
  transition: color 0.3s ease, border-bottom 0.3s ease;
}

a:hover {
  text-decoration: underline;
  color: #3d8361;
  
}

.active {
  color: #3d8361;
  font-weight: bold;
  pointer-events: none;
}

body {
  margin: 0;
  background-color: #F3F0DB;
  font-family: 'Times New Roman', Times, serif;
}

.carousel {
  display: flex;
  overflow: hidden;
  background-color: #1a1a1a;
  padding: 40px 0;
  gap: 30px;
  justify-content: center;
}

.carousel-item {
  background: white;
  padding: 0;
  width: 300px;
  text-align: center;
  border-radius: 10px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.carousel-item:hover {
  transform: scale(1.02);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
}

.carousel-item img {
  width: 100%;
  height: 220px;
  object-fit: cover;
  margin-bottom: 15px;
  transition: transform 0.3s ease, filter 0.3s ease;
}

.carousel-item img:hover {
  transform: scale(1.02);
  filter: brightness(1.05);
}

.carousel-item button {
  background: none;
  color: #3d8361;
  border: 1px solid #3d8361;
  padding: 6px 12px;
  margin-top: 10px;
  cursor: pointer;
  border-radius: 20px;
  transition: background-color 0.3s ease, color 0.3s ease, transform 0.3s ease;
}
.hero button{
  background: none;
  color:white;
  background-color: #3d8361;
  border: 1px solid #3d8361;
  padding: 6px 12px;
  margin-top: 10px;
  cursor: pointer;
  border-radius: 20px;
  transition: background-color 0.3s ease, color 0.3s ease, transform 0.3s ease;
}
.carousel-item button:hover {
  background-color: #3d8361;
  color: white;
  transform: scale(1.03);
}
.hero button:hover {
  background-color: #3d8361;
  color: white;
  transform: scale(1.03);
}


.section-title {
  text-align: center;
  font-size: 28px;
  margin: 40px 0 20px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  padding: 0 60px 60px;
  border-radius: 10px;
}

.book-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  padding: 16px;
  text-align: center;
  transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
  cursor: pointer;
  position: relative; /* Needed for tag positioning */
}

.book-card:hover {
  transform: scale(1.03);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
  background-color: #eef2e6;
}

.book-card img {
  width: 100%;
  height: 230px;
  object-fit: cover;
  border-radius: 6px;
  margin-bottom: 12px;
  transition: transform 0.3s ease, filter 0.3s ease, height 0.3s ease; /* Added height transition */
}
/* Task 15: Style for enlarged image */
.book-card img.enlarged {
    height: 280px; /* New height when enlarged */
}


.book-card img:hover {
  transform: scale(1.02);
  filter: brightness(1.05);
}

.book-card h3 {
  margin: 8px 0 4px;
  font-size: 18px;
  color: #333;
}

.book-card p {
  margin: 2px 0;
  color: #555;
  font-size: 14px;
}

.book-card button {
  margin-top: 12px;
  padding: 8px 16px;
  background-color: #3d8361;
  border: none;
  color: white;
  border-radius: 20px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
}

.book-card button:hover {
  background-color: #55b888;
  transform: scale(1.03);
}

/* Style for disabled buttons */
.book-card button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
}


.tag {
  position: absolute;
  top: 10px;
  right: 10px;
  background: darkgreen;
  color: white;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: bold;
  border-radius: 4px;
}

.tag.discount {
  background: crimson;
}

.two-column-section {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  padding: 40px 60px;
  gap: 30px;
}

.section-box {
  background: white;
  flex: 1;
  min-width: 300px;
  padding: 20px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  border-radius: 10px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.section-box:hover {
  transform: scale(1.02);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
}

.section-box h3 {
  font-size: 22px;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
}

.book-row {
  display: flex;
  gap: 15px;
  margin: 15px 0;
}

.book-row img {
  width: 80px;
  height: 100px;
  object-fit: cover;
  border-radius: 4px;
  transition: transform 0.3s ease;
}

.book-row img:hover {
  transform: scale(1.05);
}

.book-info {
  flex: 1;
}

.book-info h4 {
  margin: 0;
  font-size: 16px;
}

.book-info p {
  margin: 2px 0;
  font-size: 14px;
}
.nav {
    background-color: #f2f2f2;
  display: flex;
  justify-content: space-evenly;
  padding: 15px 0;
  font-size: 18px;
}

.nav a {
  background-color: #f2f2f2;
  color: black;
  text-decoration: none;
  padding: 10px 16px;
  border-radius: 4px;
  margin: 0 5px;
  transition: background-color 0.3s ease;
}

.nav a:hover {
  background-color: #ddd;
  color: black;
}

.nav a.active {
    background-color: #f2f2f2;
  color: #3d8361;
  font-weight: bold;
  pointer-events: none;
}

  </style>
</head>
<body >

  <div style="width: 100%; margin: auto; background-color: rgb(247, 245, 245); min-height: 100vh;">

     <div style="background-color:#f2f2f2; padding: 20px 0;margin:0">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 60px; gap: 20px;">
        <div>
          <img src="logo_img.png" alt="Logo" style="height:50px;">
        </div>
        <div style="flex-grow: 1; display: flex; justify-content: center;">
          <input type="text" id="search-input" placeholder="Search books..." 
                style="width: 300px; padding: 8px; font-size: 16px; border:none; border-radius: 4px 0 0 4px;margin-right: 10px;">
          <button type="button" id="search-button"
                  style="padding: 8px 16px; background-color: #3d8361; color: white; border: none; border-radius: 0 4px 4px 0; cursor: pointer;">
            Search
          </button>
        </div>
        <div style="text-align: right;">
          <h2 style="margin: 0;"> Astra</h2>
          <p style="margin: 0;">Online Bookstore Portal</p>
        </div>
      </div>
      <hr style="margin: 10px 10px;">
      <div class="nav" style="display: flex; justify-content: space-evenly; padding: 0 80px; font-size: 18px;">
        <a href="index.html" class="active">Home</a>
        <a href="login.html">Login</a>
        <a href="categories.html">Categories</a>
        <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
        <a href="catalogue.html">Catalogue</a>
        <a href="offers.html">Offers</a>
      </div>
    </div>

    <div id="main-content">
        </div>
</div>

<script>
    // --- Task 1: Create a book object and log its rating ---
    const singleBook = {
        id: 20,
        title: "The Midnight Library",
        author: "Matt Haig",
        price: 14,
        quantity: 7,
        rating: 4.5 
    };
    console.log("The rating of the book is: " + singleBook.rating);

    // --- Task 4 & 13: Manipulate and sort the book list ---
    let bookList = [
        { title: 'Pride and Prejudice', author: 'Jane Austen' },
        { title: 'The Name of the Wind', author: 'Patrick Rothfuss' },
        { title: 'Deep Work', author: 'Cal Newport' }
    ];
    bookList.push({ title: 'Atomic Habits', author: 'James Clear' });
    bookList.shift();
    bookList.sort((a, b) => a.title.localeCompare(b.title));
    console.log("Modified and Sorted Book List:", bookList);

    // --- Global State & Constants ---
    const MAX_CART_ITEMS = 5;
    const mainContentContainer = document.getElementById('main-content');
    let booksData = {}; // Will hold all categories from JSON
    let allBooks = []; // Will hold a flattened list of all books

    // --- Cart Functions ---
    function getCart() {
        return JSON.parse(localStorage.getItem('bookCart')) || [];
    }

    function saveCart(cart) {
        localStorage.setItem('bookCart', JSON.stringify(cart));
        updateCartDisplay();
    }
    
    function updateCartDisplay() {
        document.getElementById('cart-count').innerText = getCart().length;
    }

    // --- Core Application Logic ---
    function searchBooks() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        if (!searchTerm) {
            renderHomePage(); // If search is empty, show the home page
            return;
        }

        const foundBooks = allBooks.filter(book => book.title.toLowerCase().includes(searchTerm));
        
        mainContentContainer.innerHTML = ''; // Clear main content

        const searchResultsContainer = document.createElement('div');
        searchResultsContainer.style.padding = '40px 60px';

        const title = document.createElement('h2');
        title.className = 'section-title';
        title.textContent = `Search Results for "${searchTerm}"`;
        searchResultsContainer.appendChild(title);

        if (foundBooks.length > 0) {
            const grid = document.createElement('div');
            grid.className = 'grid';
            grid.innerHTML = foundBooks.map(createRecommendationCard).join('');
            searchResultsContainer.appendChild(grid);
        } else {
            const notFoundMessage = document.createElement('p');
            notFoundMessage.textContent = "Book not found.";
            notFoundMessage.style.textAlign = 'center';
            notFoundMessage.style.fontSize = '18px';
            searchResultsContainer.appendChild(notFoundMessage);
        }
        
        const clearButton = document.createElement('button');
        clearButton.textContent = 'Clear Search';
        clearButton.style.display = 'block';
        clearButton.style.margin = '20px auto';
        clearButton.style.padding = '10px 20px';
        clearButton.onclick = () => {
            document.getElementById('search-input').value = '';
            renderHomePage();
        };
        searchResultsContainer.appendChild(clearButton);

        mainContentContainer.appendChild(searchResultsContainer);
    }
    
    function generateStars(rating) {
        let stars = '';
        for (let i = 0; i < 5; i++) {
            stars += i < rating ? '⭐' : '☆';
        }
        return stars;
    }
    
    function toggleImageSize(event) {
        const button = event.target;
        const card = button.closest('.book-card');
        const img = card.querySelector('img');
        img.classList.toggle('enlarged');
    }
    
    function addToCart(bookId) {
        let cart = getCart();

        if (cart.length >= MAX_CART_ITEMS) {
            alert("Maximum items reached! You cannot add more than 5 unique items to the cart.");
            return;
        }
        
        const isBookInCart = cart.some(item => item.id === bookId);
        if (isBookInCart) {
            alert("This book is already in your cart. You can change the quantity on the cart page.");
            return;
        }

        const bookToAdd = allBooks.find(book => book.id === bookId);
        if (bookToAdd && bookToAdd.quantity > 0) {
            cart.push({ ...bookToAdd, quantityInCart: 1 }); // Add to cart with quantity 1
            saveCart(cart);
            
            if (cart.length >= MAX_CART_ITEMS) {
                disableAllBuyButtons();
            }
        }
    }

    function disableAllBuyButtons() {
        document.querySelectorAll('.buy-button').forEach(button => {
            button.disabled = true;
            button.innerText = "Cart Full";
        });
    }

    // --- Rendering Functions ---
    function createRecommendationCard(book) {
        const tagHtml = book.tag ? `<div class="${book.tag.class}">${book.tag.text}</div>` : '';
        const isOutOfStock = book.quantity === 0;
        return `
            <div class="book-card">
                <img src="${book.img}" id="img-${book.id}">
                ${tagHtml}
                <div style="font-size: 20px; color: #ffc107;">${generateStars(book.rating)}</div>
                <p style="margin: 8px 15px;">
                    <span style="font-weight: bold;">${book.title}</span><br>
                    <span style="color: #555;">${book.author}</span>
                </p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin:0 15px">
                    <div><p style="color: #3d8361; font-weight: bold;">$${book.price}</p></div>
                    <div>
                        <button class="buy-button" onclick="addToCart(${book.id})" ${isOutOfStock ? 'disabled' : ''}>
                          ${isOutOfStock ? 'Out of Stock' : 'Buy'}
                        </button>
                    </div>
                </div>
                 <button onclick="toggleImageSize(event)" style="background: none; border: 1px solid #555; color: #555; font-size:12px; padding: 2px 8px; margin-top: 5px;">Toggle Image Size</button>
            </div>
        `;
    }

    function createLittleReaderCard(book) {
        const tagHtml = book.tag ? `<div style="position: absolute; top: 8px; right: 8px; background-color: ${book.tag.class.includes('discount') ? 'crimson' : 'darkgreen'}; color: white; font-size: 12px; padding: 2px 6px;">${book.tag.text}</div>` : '';
        const isOutOfStock = book.quantity === 0;
        return `
            <div class="book-card" style="width: 180px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="position: relative;">
                    <img src="${book.img}" style="width: 100%; height: 200px; object-fit: cover;">
                    ${tagHtml}
                </div>
                <div style="font-size: 18px; color: #ffc107;">${generateStars(book.rating)}</div>
                <p style="font-weight: bold; margin: 10px 0 0;">${book.title}</p>
                <p style="color: #555;">${book.author}</p>
                <p style="color: #3d8361; font-weight: bold;">$${book.price}</p>
                <button class="buy-button" onclick="addToCart(${book.id})" style="background: none; border: 1px solid #3d8361; color: #3d8361; padding: 5px 10px; cursor: pointer;" ${isOutOfStock ? 'disabled' : ''}>
                  ${isOutOfStock ? 'Out of Stock' : 'Buy'}
                </button>
            </div>
        `;
    }

    function createBestsellerCard(book) {
         const isOutOfStock = book.quantity === 0;
        return `
            <div class="book-card" style="display: flex; gap: 10px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); text-align: left;">
                <img src="${book.img}" style="width: 60px; height: 80px; object-fit: cover;">
                <div>
                    <p style="margin: 0; font-weight: bold;">${book.title}</p>
                    <p style="margin: 0; font-size: 14px;">${book.author}</p>
                     <div style="font-size: 16px; color: #ffc107;">${generateStars(book.rating)}</div>
                    <p style="color: #3d8361; font-weight: bold;">$${book.price}</p>
                    <button class="buy-button" onclick="addToCart(${book.id})" style="padding: 2px 8px; font-size: 12px;" ${isOutOfStock ? 'disabled' : ''}>
                      ${isOutOfStock ? 'Out of Stock' : 'Buy'}
                    </button>
                </div>
            </div>
        `;
    }

    function createSelfDevCard(book) {
        const tagHtml = book.tag ? `<div style="position: absolute; top: 8px; right: 8px; background-color: darkgreen; color: white; font-size: 12px; padding: 2px 6px;">New</div>` : '';
        const isOutOfStock = book.quantity === 0;
        return `
             <div class="book-card" style="flex: 0 0 auto; width: 180px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="position: relative;">
                    <img src="${book.img}" style="width: 100%; height: 200px; object-fit: cover;">
                    ${tagHtml}
                </div>
                <div style="font-size: 18px; color: #ffc107;">${generateStars(book.rating)}</div>
                <p style="font-weight: bold; margin: 10px 0 0;">${book.title}</p>
                <p style="color: #555;">${book.author}</p>
                <p style="color: #3d8361; font-weight: bold;">$${book.price}</p>
                <button class="buy-button" onclick="addToCart(${book.id})" style="background: none; border: 1px solid #3d8361; color: #3d8361; padding: 5px 10px; cursor: pointer;" ${isOutOfStock ? 'disabled' : ''}>
                  ${isOutOfStock ? 'Out of Stock' : 'Buy'}
                </button>
            </div>
        `;
    }

    function renderHomePage() {
        const { recommendedBooks, littleReaderBooks, bestsellers, selfDevelopmentBooks } = booksData;
        mainContentContainer.innerHTML = `
            <div class="hero" style="padding: 30px;background-color: white;">
                <h2 style="color: #3d8361;">Welcome to Astra!</h2>
                <p style="color:gray;width:35%;margin-top:-1%">Your one-stop destination for fiction, non-fiction, academic, and children’s books. Discover, read, and enjoy a world of knowledge!</p>
                <button>Learn more</button>
                <a href="about-astra.html"><button>About Astra</button></a>
            </div>

            <div class="carousel">
                <div class="carousel-item"><div class="book-card"><img src=""><h3>Simple Lines</h3><p>Marina Diamond</p><button>Learn more</button></div></div>
                <div class="carousel-item"><div class="book-card"><img src=""><h3>New Book</h3><p>Angela Rickman</p><button>Learn more</button></div></div>
                <div class="carousel-item"><div class="book-card"><img src=""><h3>30% OFF Summer Reads</h3><p>Use code “SUMMER25” at checkout</p><button>Learn more</button></div></div>
            </div>

            <div class="section-title">Our recommendations</div>
            <div class="grid" id="recommendations-grid">
                ${recommendedBooks.map(createRecommendationCard).join('')}
            </div>

            <div class="two-column-section">
                <div class="section-box" style="flex:2;border-radius: 20px;">
                    <h2 style="margin-bottom: 20px;">For little readers</h2>
                    <div id="little-readers-section" style="display: flex; gap: 20px; flex-wrap: wrap;">
                        ${littleReaderBooks.map(createLittleReaderCard).join('')}
                    </div>
                </div>
                <div class="section-box" style="width: 30%;border-radius: 20px;">
                    <h2 style="margin-bottom: 20px;">Bestsellers</h2>
                    <div id="bestsellers-section" style="display: flex; flex-direction: column; gap: 20px;">
                        ${bestsellers.map(createBestsellerCard).join('')}
                    </div>
                </div>
            </div>

            <div style="padding: 40px 60px;margin:0;box-shadow:0 2px 8px rgba(0,0,0,0.05) ;">
                <h2 style="margin-bottom: 20px;">Self-development</h2>
                <div class="section-box" id="self-development-section" style="display: flex; overflow-x: auto; gap: 20px; flex-wrap: nowrap; padding-bottom: 10px;border-radius: 20px;">
                    ${selfDevelopmentBooks.map(createSelfDevCard).join('')}
                </div>
            </div>
        `;
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Show a loading message while we fetch data
        mainContentContainer.innerHTML = '<p style="text-align:center; font-size: 18px; padding: 40px;">Loading books...</p>';

        fetch('books.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // Populate global variables with the data from JSON
                booksData = data;
                allBooks = [
                    ...booksData.recommendedBooks,
                    ...booksData.littleReaderBooks,
                    ...booksData.bestsellers,
                    ...booksData.selfDevelopmentBooks
                ];

                // Now that data is loaded, render the page and set up listeners
                updateCartDisplay();
                renderHomePage();
                
                document.getElementById('search-button').addEventListener('click', searchBooks);
                document.getElementById('search-input').addEventListener('keyup', (event) => {
                    if (event.key === 'Enter') {
                        searchBooks();
                    }
                });
            })
            .catch(error => {
                console.error('Error loading book data:', error);
                mainContentContainer.innerHTML = `<p style="text-align:center; color:red; font-size: 18px; padding: 40px;">Could not load book data. Please try again later.</p>`;
            });
    });

    // Make functions that are called by inline 'onclick' handlers globally available.
    window.addToCart = addToCart;
    window.toggleImageSize = toggleImageSize;
</script>

</body>
</html>
